
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Unified League of Legends API Gateway with caching, rate limiting, and comprehensive monitoring" name="description"/>
<link href="../troubleshooting/" rel="prev"/>
<link href="../../development/contributing/" rel="next"/>
<link href="../../assets/logo.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.23" name="generator"/>
<title>Security - LOLStonks API Gateway</title>
<link href="../../assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/_mkdocstrings.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#security-best-practices">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="LOLStonks API Gateway" class="md-header__button md-logo" data-md-component="logo" href="../.." title="LOLStonks API Gateway">
<img alt="logo" src="../../assets/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            LOLStonks API Gateway
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Security
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/OneStepAt4time/lolstonks-api-gateway" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../CHANGELOG.md">
        
  
  
    
  
  Changelog

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/installation/">
          
  
  
    
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../api/openapi-spec/">
          
  
  
    
  
  API Reference

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../architecture/overview/">
          
  
  
    
  
  Architecture

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../monitoring/">
          
  
  
    
  
  Operations

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../development/contributing/">
          
  
  
    
  
  Development

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="LOLStonks API Gateway" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="LOLStonks API Gateway">
<img alt="logo" src="../../assets/logo.png"/>
</a>
    LOLStonks API Gateway
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/OneStepAt4time/lolstonks-api-gateway" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CHANGELOG.md">
<span class="md-ellipsis">
    Changelog
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/installation/">
<span class="md-ellipsis">
    Installation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/quick-start/">
<span class="md-ellipsis">
    Quick Start
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/configuration/">
<span class="md-ellipsis">
    Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/deployment/">
<span class="md-ellipsis">
    Production Deployment
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    API Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/openapi-spec/">
<span class="md-ellipsis">
    OpenAPI Specification
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/overview/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/providers/">
<span class="md-ellipsis">
    Providers
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/riot-client/">
<span class="md-ellipsis">
    Riot Client
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/models/">
<span class="md-ellipsis">
    Models
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/routers/">
<span class="md-ellipsis">
    Routers
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/cache/">
<span class="md-ellipsis">
    Cache
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/security/">
<span class="md-ellipsis">
    Security
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/overview/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/diagram-guide.md">
<span class="md-ellipsis">
    Diagram Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/system-overview.md">
<span class="md-ellipsis">
    System Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/data-flow.md">
<span class="md-ellipsis">
    Data Flow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/implementation-details/">
<span class="md-ellipsis">
    Implementation Details
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/models/">
<span class="md-ellipsis">
    Data Models
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
<span class="md-ellipsis">
    Operations
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Operations
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../monitoring/">
<span class="md-ellipsis">
    Monitoring
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Security
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Security
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api-key-security">
<span class="md-ellipsis">
      API Key Security
    </span>
</a>
<nav aria-label="API Key Security" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#secure-key-management">
<span class="md-ellipsis">
      Secure Key Management
    </span>
</a>
<nav aria-label="Secure Key Management" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#environment-based-configuration">
<span class="md-ellipsis">
      Environment-Based Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#current-implementation">
<span class="md-ellipsis">
      Current Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-storage-best-practices">
<span class="md-ellipsis">
      Key Storage Best Practices
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#input-validation-sanitization">
<span class="md-ellipsis">
      Input Validation &amp; Sanitization
    </span>
</a>
<nav aria-label="Input Validation &amp; Sanitization" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pydantic-model-validation-currently-implemented">
<span class="md-ellipsis">
      Pydantic Model Validation (Currently Implemented ‚úÖ)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced-input-sanitization-potential-enhancement">
<span class="md-ellipsis">
      Advanced Input Sanitization (Potential Enhancement)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rate-limiting-ddos-protection">
<span class="md-ellipsis">
      Rate Limiting &amp; DDoS Protection
    </span>
</a>
<nav aria-label="Rate Limiting &amp; DDoS Protection" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#current-implementation_1">
<span class="md-ellipsis">
      Current Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ip-based-rate-limiting-potential-enhancement">
<span class="md-ellipsis">
      IP-Based Rate Limiting (Potential Enhancement)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ip-based-blocking-potential-enhancement">
<span class="md-ellipsis">
      IP-Based Blocking (Potential Enhancement)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#network-security">
<span class="md-ellipsis">
      Network Security
    </span>
</a>
<nav aria-label="Network Security" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ssltls-configuration">
<span class="md-ellipsis">
      SSL/TLS Configuration
    </span>
</a>
<nav aria-label="SSL/TLS Configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#nginx-ssl-configuration-deployment-best-practice">
<span class="md-ellipsis">
      Nginx SSL Configuration (Deployment Best Practice ‚úÖ)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#application-ssl-settings-potential-enhancement">
<span class="md-ellipsis">
      Application SSL Settings (Potential Enhancement)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#firewall-configuration-deployment-best-practice">
<span class="md-ellipsis">
      Firewall Configuration (Deployment Best Practice ‚úÖ)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authentication-authorization">
<span class="md-ellipsis">
      Authentication &amp; Authorization
    </span>
</a>
<nav aria-label="Authentication &amp; Authorization" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#api-key-authentication-potential-enhancement">
<span class="md-ellipsis">
      API Key Authentication (Potential Enhancement)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cors-configuration-potential-enhancement">
<span class="md-ellipsis">
      CORS Configuration (Potential Enhancement)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#logging-monitoring">
<span class="md-ellipsis">
      Logging &amp; Monitoring
    </span>
</a>
<nav aria-label="Logging &amp; Monitoring" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#current-implementation_2">
<span class="md-ellipsis">
      Current Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-logging-potential-enhancement">
<span class="md-ellipsis">
      Security Logging (Potential Enhancement)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-monitoring-potential-enhancement">
<span class="md-ellipsis">
      Security Monitoring (Potential Enhancement)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-auditing">
<span class="md-ellipsis">
      Security Auditing
    </span>
</a>
<nav aria-label="Security Auditing" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#regular-security-checks-best-practice">
<span class="md-ellipsis">
      Regular Security Checks (Best Practice ‚úÖ)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-checklist">
<span class="md-ellipsis">
      Security Checklist
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary">
<span class="md-ellipsis">
      Summary
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Development
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Development
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/contributing/">
<span class="md-ellipsis">
    Contributing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/changelog-guide/">
<span class="md-ellipsis">
    Changelog Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/versioning/">
<span class="md-ellipsis">
    Versioning
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/releases/">
<span class="md-ellipsis">
    Releases
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/testing/">
<span class="md-ellipsis">
    Testing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/documentation/">
<span class="md-ellipsis">
    Documentation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api-key-security">
<span class="md-ellipsis">
      API Key Security
    </span>
</a>
<nav aria-label="API Key Security" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#secure-key-management">
<span class="md-ellipsis">
      Secure Key Management
    </span>
</a>
<nav aria-label="Secure Key Management" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#environment-based-configuration">
<span class="md-ellipsis">
      Environment-Based Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#current-implementation">
<span class="md-ellipsis">
      Current Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-storage-best-practices">
<span class="md-ellipsis">
      Key Storage Best Practices
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#input-validation-sanitization">
<span class="md-ellipsis">
      Input Validation &amp; Sanitization
    </span>
</a>
<nav aria-label="Input Validation &amp; Sanitization" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pydantic-model-validation-currently-implemented">
<span class="md-ellipsis">
      Pydantic Model Validation (Currently Implemented ‚úÖ)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced-input-sanitization-potential-enhancement">
<span class="md-ellipsis">
      Advanced Input Sanitization (Potential Enhancement)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rate-limiting-ddos-protection">
<span class="md-ellipsis">
      Rate Limiting &amp; DDoS Protection
    </span>
</a>
<nav aria-label="Rate Limiting &amp; DDoS Protection" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#current-implementation_1">
<span class="md-ellipsis">
      Current Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ip-based-rate-limiting-potential-enhancement">
<span class="md-ellipsis">
      IP-Based Rate Limiting (Potential Enhancement)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ip-based-blocking-potential-enhancement">
<span class="md-ellipsis">
      IP-Based Blocking (Potential Enhancement)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#network-security">
<span class="md-ellipsis">
      Network Security
    </span>
</a>
<nav aria-label="Network Security" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ssltls-configuration">
<span class="md-ellipsis">
      SSL/TLS Configuration
    </span>
</a>
<nav aria-label="SSL/TLS Configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#nginx-ssl-configuration-deployment-best-practice">
<span class="md-ellipsis">
      Nginx SSL Configuration (Deployment Best Practice ‚úÖ)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#application-ssl-settings-potential-enhancement">
<span class="md-ellipsis">
      Application SSL Settings (Potential Enhancement)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#firewall-configuration-deployment-best-practice">
<span class="md-ellipsis">
      Firewall Configuration (Deployment Best Practice ‚úÖ)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authentication-authorization">
<span class="md-ellipsis">
      Authentication &amp; Authorization
    </span>
</a>
<nav aria-label="Authentication &amp; Authorization" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#api-key-authentication-potential-enhancement">
<span class="md-ellipsis">
      API Key Authentication (Potential Enhancement)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cors-configuration-potential-enhancement">
<span class="md-ellipsis">
      CORS Configuration (Potential Enhancement)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#logging-monitoring">
<span class="md-ellipsis">
      Logging &amp; Monitoring
    </span>
</a>
<nav aria-label="Logging &amp; Monitoring" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#current-implementation_2">
<span class="md-ellipsis">
      Current Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-logging-potential-enhancement">
<span class="md-ellipsis">
      Security Logging (Potential Enhancement)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-monitoring-potential-enhancement">
<span class="md-ellipsis">
      Security Monitoring (Potential Enhancement)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-auditing">
<span class="md-ellipsis">
      Security Auditing
    </span>
</a>
<nav aria-label="Security Auditing" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#regular-security-checks-best-practice">
<span class="md-ellipsis">
      Regular Security Checks (Best Practice ‚úÖ)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-checklist">
<span class="md-ellipsis">
      Security Checklist
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary">
<span class="md-ellipsis">
      Summary
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="security-best-practices">Security Best Practices<a class="headerlink" href="#security-best-practices" title="Permanent link">¬∂</a></h1>
<p>This guide covers security considerations and best practices for deploying and operating the LOLStonks API Gateway in production environments.</p>
<blockquote>
<p><strong>üìù Documentation Note</strong>: This document describes <strong>security best practices and potential implementations</strong>. Many advanced security features represent future enhancements rather than current implementation.</p>
<p><strong>Currently Implemented</strong> ‚úÖ:
- Input validation using Pydantic models
- Basic rate limiting (Riot API level with aiolimiter)
- API key loading from environment variables
- <strong>API key rotation system</strong> (round-robin across multiple keys)
- Redis password authentication (if configured)</p>
<p><strong>Not Yet Implemented</strong> ‚ùå (Potential Future Enhancements):
- IP-based rate limiting and blocking
- Advanced input sanitization
- CORS middleware
- HTTPS redirect middleware
- Security event logging
- Prometheus security metrics</p>
<p>For actual implementation details, see <a href="../../architecture/implementation-details/">Implementation Details</a>.</p>
</blockquote>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¬∂</a></h2>
<p>Security is implemented through multiple layers of protection:</p>
<ol>
<li><strong>Input Validation</strong>: Comprehensive request validation using Pydantic models ‚úÖ</li>
<li><strong>Rate Limiting</strong>: Protection against abuse and DoS attacks ‚ö†Ô∏è (Riot API level only)</li>
<li><strong>Authentication &amp; Authorization</strong>: Secure API key management ‚ö†Ô∏è (Basic environment variable)</li>
<li><strong>Network Security</strong>: Firewall rules and secure communications ‚ö†Ô∏è (Infrastructure level)</li>
<li><strong>Monitoring &amp; Auditing</strong>: Comprehensive logging and threat detection ‚ùå (Not implemented)</li>
</ol>
<h2 id="api-key-security">API Key Security<a class="headerlink" href="#api-key-security" title="Permanent link">¬∂</a></h2>
<h3 id="secure-key-management">Secure Key Management<a class="headerlink" href="#secure-key-management" title="Permanent link">¬∂</a></h3>
<h4 id="environment-based-configuration">Environment-Based Configuration<a class="headerlink" href="#environment-based-configuration" title="Permanent link">¬∂</a></h4>
<pre><code class="language-env"># Never hardcode API keys in source code
RIOT_API_KEY=RGAPI-your-secure-api-key

# Use separate keys for different environments
RIOT_API_KEY_DEV=RGAPI-dev-key
RIOT_API_KEY_STAGING=RGAPI-staging-key
RIOT_API_KEY_PROD=RGAPI-production-key
</code></pre>
<h4 id="current-implementation">Current Implementation<a class="headerlink" href="#current-implementation" title="Permanent link">¬∂</a></h4>
<p>The gateway supports both single key and multiple key rotation:</p>
<pre><code class="language-env"># .env file (ACTUAL IMPLEMENTATION)

# Option 1: Single API key (backward compatible)
RIOT_API_KEY=RGAPI-your-secure-api-key

# Option 2: Multiple API keys for rotation (recommended for production)
# Comma-separated list. Gateway will rotate through keys using round-robin.
# This helps distribute load and avoid hitting rate limits on a single key.
# If RIOT_API_KEYS is set, it takes priority over RIOT_API_KEY.
RIOT_API_KEYS=RGAPI-key1,RGAPI-key2,RGAPI-key3
</code></pre>
<p>The API key rotation is implemented using a round-robin algorithm:</p>
<pre><code class="language-python"># app/config.py (ACTUAL IMPLEMENTATION)
class Settings(BaseSettings):
    riot_api_key: str | None = None  # Single key (backward compatible)
    riot_api_keys: str | None = None  # Multiple keys for rotation

    def get_api_keys(self) -&gt; list[str]:
        """Get list of API keys with priority: RIOT_API_KEYS &gt; RIOT_API_KEY."""
        # Priority 1: Multiple keys (comma-separated)
        if self.riot_api_keys and self.riot_api_keys.strip():
            keys = [k.strip() for k in self.riot_api_keys.split(",") if k.strip()]
            if keys:
                return keys

        # Priority 2: Single key (backward compatibility)
        if self.riot_api_key and self.riot_api_key.strip():
            return [self.riot_api_key.strip()]

        raise ValueError("No Riot API keys configured")

# app/riot/key_rotator.py (ACTUAL IMPLEMENTATION)
class KeyRotator:
    """Thread-safe round-robin key rotator for Riot API keys."""

    def get_next_key(self) -&gt; str:
        """Get the next API key in round-robin rotation."""
        with self._lock:
            key = self.api_keys[self._current_index]
            self._current_index = (self._current_index + 1) % len(self.api_keys)
            return key
</code></pre>
<p><strong>Benefits of Key Rotation</strong>:
- Distributes load across multiple keys using round-robin
- Reduces risk of hitting rate limits on a single key
- Provides redundancy if one key becomes rate-limited
- On 429 responses, immediately tries the next key without waiting
- Only waits if ALL keys are exhausted</p>
<h4 id="key-storage-best-practices">Key Storage Best Practices<a class="headerlink" href="#key-storage-best-practices" title="Permanent link">¬∂</a></h4>
<ol>
<li><strong>Use Environment Variables</strong>: Never store keys in code or configuration files</li>
<li><strong>Separate Environments</strong>: Use different keys for dev, staging, and production</li>
<li><strong>Regular Rotation</strong>: Rotate keys every 20-25 days (Riot API keys expire in 30 days)</li>
<li><strong>Backup Keys</strong>: Maintain backup keys for failover scenarios</li>
<li><strong>Access Control</strong>: Limit access to API keys to only necessary personnel</li>
</ol>
<h2 id="input-validation-sanitization">Input Validation &amp; Sanitization<a class="headerlink" href="#input-validation-sanitization" title="Permanent link">¬∂</a></h2>
<h3 id="pydantic-model-validation-currently-implemented">Pydantic Model Validation (Currently Implemented ‚úÖ)<a class="headerlink" href="#pydantic-model-validation-currently-implemented" title="Permanent link">¬∂</a></h3>
<p>All API inputs are validated using Pydantic models. This is <strong>currently implemented</strong> in the codebase:</p>
<pre><code class="language-python"># app/models/security.py
from pydantic import BaseModel, Field, validator
import re
from typing import Optional

class SecureSummonerNameParams(BaseModel):
    """Securely validated summoner name parameters."""

    summonerName: str = Field(
        min_length=1,
        max_length=16,
        description="Summoner name (1-16 characters)"
    )

    @validator('summonerName')
    def validate_summoner_name(cls, v):
        """Validate summoner name format."""
        # Remove potentially dangerous characters
        cleaned = re.sub(r'[^\w\s]', '', v.strip())

        # Check for allowed characters (letters, numbers, spaces)
        if not re.match(r'^[a-zA-Z0-9\s]+$', cleaned):
            raise ValueError('Invalid summoner name format')

        return cleaned

class SecureRegionQuery(BaseModel):
    """Securely validated region parameters."""

    region: str = Field(
        default="euw1",
        description="Riot API region code"
    )

    @validator('region')
    def validate_region(cls, v):
        """Validate region code against allowed list."""
        allowed_regions = {
            'euw1', 'eun1', 'tr1', 'ru',  # Europe
            'na1', 'br1', 'la1', 'la2',   # Americas
            'kr', 'jp1',                  # Asia
            'oc1', 'ph2', 'sg2', 'th2', 'tw2', 'vn2'  # SEA/Oceania
        }

        if v.lower() not in allowed_regions:
            raise ValueError(f'Invalid region: {v}')

        return v.lower()
</code></pre>
<h3 id="advanced-input-sanitization-potential-enhancement">Advanced Input Sanitization (Potential Enhancement)<a class="headerlink" href="#advanced-input-sanitization-potential-enhancement" title="Permanent link">¬∂</a></h3>
<blockquote>
<p><strong>Not Implemented</strong>: Advanced input sanitization beyond Pydantic validation is not currently implemented.</p>
</blockquote>
<p>The current implementation relies on Pydantic validators (shown above). More advanced sanitization could be added:</p>
<pre><code class="language-python"># Example: app/security/validation.py (NOT IMPLEMENTED)
import re
from typing import Any, Dict, List

class SecurityValidator:
    """Security-focused input validation."""

    @staticmethod
    def sanitize_string(input_str: str, max_length: int = 100) -&gt; str:
        """Sanitize string inputs."""
        if not isinstance(input_str, str):
            raise TypeError("Input must be a string")

        # Remove potentially dangerous characters
        sanitized = re.sub(r'[&lt;&gt;"\';\\&amp;]', '', input_str)

        # Truncate to max length
        sanitized = sanitized[:max_length]

        return sanitized.strip()

    @staticmethod
    def validate_puuid(puuid: str) -&gt; bool:
        """Validate PUUID format."""
        pattern = r'^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
        return bool(re.match(pattern, puuid.lower()))

    @staticmethod
    def validate_match_id(match_id: str) -&gt; bool:
        """Validate match ID format."""
        pattern = r'^[A-Z0-9_]+$'
        return bool(re.match(pattern, match_id))
</code></pre>
<h2 id="rate-limiting-ddos-protection">Rate Limiting &amp; DDoS Protection<a class="headerlink" href="#rate-limiting-ddos-protection" title="Permanent link">¬∂</a></h2>
<h3 id="current-implementation_1">Current Implementation<a class="headerlink" href="#current-implementation_1" title="Permanent link">¬∂</a></h3>
<p>The application implements rate limiting <strong>only at the Riot API level</strong> using aiolimiter:</p>
<pre><code class="language-python"># app/riot/rate_limiter.py (ACTUAL IMPLEMENTATION)
from aiolimiter import AsyncLimiter

class RiotRateLimiter:
    def __init__(self):
        self.limiter_1s = AsyncLimiter(
            max_rate=settings.riot_rate_limit_per_second,
            time_period=1,
        )
        self.limiter_2min = AsyncLimiter(
            max_rate=settings.riot_rate_limit_per_2min,
            time_period=120,
        )
</code></pre>
<blockquote>
<p><strong>Limitation</strong>: This only limits requests to the Riot API, not incoming requests from clients.</p>
</blockquote>
<h3 id="ip-based-rate-limiting-potential-enhancement">IP-Based Rate Limiting (Potential Enhancement)<a class="headerlink" href="#ip-based-rate-limiting-potential-enhancement" title="Permanent link">¬∂</a></h3>
<blockquote>
<p><strong>Not Implemented</strong>: Per-IP rate limiting and DDoS protection are not currently implemented.</p>
</blockquote>
<pre><code class="language-python"># Example: app/security/rate_limiting.py (NOT IMPLEMENTED)
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address
from slowapi.errors import RateLimitExceeded
from fastapi import Request, HTTPException
import redis
import json

# Initialize rate limiter with Redis backend
redis_client = redis.Redis(
    host='localhost',
    port=6379,
    password='your-redis-password',
    decode_responses=True
)

limiter = Limiter(
    key_func=get_remote_address,
    storage_uri="redis://localhost:6379",
    default_limits=["1000/hour"]  # Global limit
)

# Custom rate limit exceeded handler
async def rate_limit_exceeded_handler(request: Request, exc: RateLimitExceeded):
    """Custom handler for rate limit exceeded."""
    client_ip = get_remote_address(request)
    logger.warning(f"Rate limit exceeded for IP: {client_ip}")

    raise HTTPException(
        status_code=429,
        detail={
            "error": "Rate limit exceeded",
            "message": "Too many requests. Please try again later.",
            "retry_after": exc.detail  # Seconds to wait
        }
    )

# Apply rate limiting to sensitive endpoints
@app.get("/summoner/by-name/{summonerName}")
@limiter.limit("100/minute")  # Stricter limit for summoner lookups
async def get_summoner_by_name(
    request: Request,
    summonerName: str,
    region: str = "euw1"
):
    """Get summoner by name with rate limiting."""
    pass
</code></pre>
<h3 id="ip-based-blocking-potential-enhancement">IP-Based Blocking (Potential Enhancement)<a class="headerlink" href="#ip-based-blocking-potential-enhancement" title="Permanent link">¬∂</a></h3>
<blockquote>
<p><strong>Not Implemented</strong>: IP blocking is not currently implemented.</p>
</blockquote>
<pre><code class="language-python"># Example: app/security/ip_blocking.py (NOT IMPLEMENTED)
from typing import Set, Dict
from datetime import datetime, timedelta
import json

class IPBlocker:
    """Manages IP blocking for malicious actors."""

    def __init__(self, redis_client):
        self.redis = redis_client
        self.block_duration = timedelta(hours=1)
        self.permanent_block_threshold = 100  # Violations for permanent block

    async def block_ip(self, ip: str, reason: str, permanent: bool = False):
        """Block an IP address."""
        block_data = {
            "ip": ip,
            "reason": reason,
            "timestamp": datetime.now().isoformat(),
            "permanent": permanent
        }

        if permanent:
            await self.redis.set(f"blocked_ip:{ip}", json.dumps(block_data))
        else:
            await self.redis.setex(
                f"blocked_ip:{ip}",
                int(self.block_duration.total_seconds()),
                json.dumps(block_data)
            )

    async def is_ip_blocked(self, ip: str) -&gt; bool:
        """Check if IP is blocked."""
        return await self.redis.exists(f"blocked_ip:{ip}")

    async def record_violation(self, ip: str, violation_type: str):
        """Record a security violation."""
        violation_key = f"violations:{ip}"

        # Increment violation count
        count = await self.redis.incr(violation_key)
        await self.redis.expire(violation_key, 86400)  # 24 hours

        # Check if should be permanently blocked
        if count &gt;= self.permanent_block_threshold:
            await self.block_ip(ip, f"Too many violations: {count}", permanent=True)

        return count

# Middleware for IP blocking
@app.middleware("http")
async def ip_blocking_middleware(request: Request, call_next):
    """Check for blocked IPs before processing requests."""
    client_ip = get_remote_address(request)

    if await ip_blocker.is_ip_blocked(client_ip):
        raise HTTPException(
            status_code=403,
            detail="Access denied"
        )

    response = await call_next(request)
    return response
</code></pre>
<h2 id="network-security">Network Security<a class="headerlink" href="#network-security" title="Permanent link">¬∂</a></h2>
<blockquote>
<p><strong>Infrastructure Level</strong>: Network security is typically handled at the infrastructure/deployment level, not in application code.</p>
</blockquote>
<h3 id="ssltls-configuration">SSL/TLS Configuration<a class="headerlink" href="#ssltls-configuration" title="Permanent link">¬∂</a></h3>
<h4 id="nginx-ssl-configuration-deployment-best-practice">Nginx SSL Configuration (Deployment Best Practice ‚úÖ)<a class="headerlink" href="#nginx-ssl-configuration-deployment-best-practice" title="Permanent link">¬∂</a></h4>
<pre><code class="language-nginx"># /etc/nginx/sites-available/lolstonks-api
server {
    listen 443 ssl http2;
    server_name api.yourdomain.com;

    # SSL Configuration
    ssl_certificate /etc/letsencrypt/live/api.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.yourdomain.com/privkey.pem;

    # Strong SSL Configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    # Security Headers
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Content-Security-Policy "default-src 'self'"; always;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # SSL offloading
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header X-Forwarded-SSL on;
    }
}
</code></pre>
<h4 id="application-ssl-settings-potential-enhancement">Application SSL Settings (Potential Enhancement)<a class="headerlink" href="#application-ssl-settings-potential-enhancement" title="Permanent link">¬∂</a></h4>
<blockquote>
<p><strong>Not Implemented</strong>: HTTPS redirect and trusted host middleware are not currently configured in the application.</p>
</blockquote>
<pre><code class="language-python"># Example: app/security/ssl.py (NOT IMPLEMENTED)
from fastapi import FastAPI
from fastapi.middleware.httpsredirect import HTTPSRedirectMiddleware
from fastapi.middleware.trustedhost import TrustedHostMiddleware

def configure_security_middleware(app: FastAPI):
    """Configure security middleware for the FastAPI app."""

    # Force HTTPS in production
    if os.getenv("ENVIRONMENT") == "production":
        app.add_middleware(HTTPSRedirectMiddleware)

    # Only allow trusted hosts
    allowed_hosts = os.getenv("ALLOWED_HOSTS", "localhost,127.0.0.1").split(",")
    app.add_middleware(
        TrustedHostMiddleware,
        allowed_hosts=allowed_hosts
    )

    return app
</code></pre>
<h3 id="firewall-configuration-deployment-best-practice">Firewall Configuration (Deployment Best Practice ‚úÖ)<a class="headerlink" href="#firewall-configuration-deployment-best-practice" title="Permanent link">¬∂</a></h3>
<blockquote>
<p><strong>Infrastructure Level</strong>: Firewall configuration is handled at the system/deployment level.</p>
</blockquote>
<pre><code class="language-bash">#!/bin/bash
# Example: firewall_setup.sh

# Reset firewall rules
sudo ufw --force reset

# Default policies
sudo ufw default deny incoming
sudo ufw default allow outgoing

# Allow SSH (restrict to your IP if possible)
sudo ufw allow 22/tcp

# Allow HTTP/HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Allow Redis only from localhost
sudo ufw allow from 127.0.0.1 to any port 6379

# Rate limiting for HTTP
sudo ufw limit 80/tcp
sudo ufw limit 443/tcp

# Enable firewall
sudo ufw --force enable

# Show status
sudo ufw status verbose
</code></pre>
<h2 id="authentication-authorization">Authentication &amp; Authorization<a class="headerlink" href="#authentication-authorization" title="Permanent link">¬∂</a></h2>
<blockquote>
<p><strong>Not Implemented</strong>: Advanced authentication for admin endpoints is not currently implemented.</p>
</blockquote>
<p>The current implementation only uses the Riot API key for accessing Riot's services. There is no authentication for accessing the gateway itself.</p>
<h3 id="api-key-authentication-potential-enhancement">API Key Authentication (Potential Enhancement)<a class="headerlink" href="#api-key-authentication-potential-enhancement" title="Permanent link">¬∂</a></h3>
<blockquote>
<p><strong>Not Implemented</strong>: API key authentication for gateway endpoints is not currently implemented.</p>
</blockquote>
<pre><code class="language-python"># Example: app/security/auth.py (NOT IMPLEMENTED)
from fastapi import HTTPException, Security, Depends
from fastapi.security import APIKeyHeader
import os
import hashlib
import hmac

class APIKeyAuth:
    """API key authentication for admin endpoints."""

    def __init__(self):
        self.api_key = os.getenv("ADMIN_API_KEY")
        if not self.api_key:
            raise ValueError("ADMIN_API_KEY environment variable required")

    def verify_key(self, provided_key: str) -&gt; bool:
        """Verify provided API key using constant-time comparison."""
        return hmac.compare_digest(
            hashlib.sha256(provided_key.encode()).hexdigest(),
            hashlib.sha256(self.api_key.encode()).hexdigest()
        )

# Initialize API key authentication
api_key_header = APIKeyHeader(name="X-API-Key", auto_error=False)
auth = APIKeyAuth()

async def verify_api_key(api_key: str = Security(api_key_header)):
    """Dependency for API key verification."""
    if not api_key or not auth.verify_key(api_key):
        raise HTTPException(
            status_code=403,
            detail="Invalid or missing API key"
        )
    return api_key

# Usage in endpoints
@app.get("/admin/stats")
async def get_admin_stats(api_key: str = Depends(verify_api_key)):
    """Admin-only endpoint with API key authentication."""
    pass
</code></pre>
<h3 id="cors-configuration-potential-enhancement">CORS Configuration (Potential Enhancement)<a class="headerlink" href="#cors-configuration-potential-enhancement" title="Permanent link">¬∂</a></h3>
<blockquote>
<p><strong>Not Implemented</strong>: CORS middleware is not currently configured.</p>
</blockquote>
<pre><code class="language-python"># Example: app/security/cors.py (NOT IMPLEMENTED)
from fastapi.middleware.cors import CORSMiddleware
import os

def configure_cors(app: FastAPI):
    """Configure CORS based on environment."""

    # Production CORS settings
    if os.getenv("ENVIRONMENT") == "production":
        allowed_origins = os.getenv("CORS_ORIGINS", "https://yourdomain.com").split(",")
        app.add_middleware(
            CORSMiddleware,
            allow_origins=allowed_origins,
            allow_credentials=True,
            allow_methods=["GET", "POST", "PUT", "DELETE"],
            allow_headers=["*"],
            expose_headers=["X-Request-ID"]
        )
    else:
        # Development CORS settings
        app.add_middleware(
            CORSMiddleware,
            allow_origins=["*"],
            allow_credentials=True,
            allow_methods=["*"],
            allow_headers=["*"]
        )
</code></pre>
<h2 id="logging-monitoring">Logging &amp; Monitoring<a class="headerlink" href="#logging-monitoring" title="Permanent link">¬∂</a></h2>
<h3 id="current-implementation_2">Current Implementation<a class="headerlink" href="#current-implementation_2" title="Permanent link">¬∂</a></h3>
<p>The application uses basic Loguru logging (see monitoring.md). Security-specific logging is not currently implemented.</p>
<h3 id="security-logging-potential-enhancement">Security Logging (Potential Enhancement)<a class="headerlink" href="#security-logging-potential-enhancement" title="Permanent link">¬∂</a></h3>
<blockquote>
<p><strong>Not Implemented</strong>: Dedicated security event logging is not currently implemented.</p>
</blockquote>
<pre><code class="language-python"># Example: app/security/logging.py (NOT IMPLEMENTED)
import logging
import json
from datetime import datetime
from typing import Dict, Any

class SecurityLogger:
    """Specialized logger for security events."""

    def __init__(self):
        self.logger = logging.getLogger("security")

        # Configure security logger
        handler = logging.FileHandler("/var/log/lolstonks/security.log")
        formatter = logging.Formatter(
            '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
        )
        handler.setFormatter(formatter)
        self.logger.addHandler(handler)
        self.logger.setLevel(logging.INFO)

    def log_security_event(self, event_type: str, details: Dict[str, Any]):
        """Log a security event."""
        event = {
            "timestamp": datetime.now().isoformat(),
            "event_type": event_type,
            "details": details
        }

        self.logger.info(json.dumps(event))

    def log_blocked_request(self, ip: str, endpoint: str, reason: str):
        """Log a blocked request."""
        self.log_security_event("blocked_request", {
            "ip": ip,
            "endpoint": endpoint,
            "reason": reason
        })

    def log_rate_limit_violation(self, ip: str, endpoint: str):
        """Log rate limit violation."""
        self.log_security_event("rate_limit_violation", {
            "ip": ip,
            "endpoint": endpoint
        })

    def log_authentication_failure(self, ip: str, key_provided: bool):
        """Log authentication failure."""
        self.log_security_event("auth_failure", {
            "ip": ip,
            "key_provided": key_provided
        })

# Initialize security logger
security_logger = SecurityLogger()
</code></pre>
<h3 id="security-monitoring-potential-enhancement">Security Monitoring (Potential Enhancement)<a class="headerlink" href="#security-monitoring-potential-enhancement" title="Permanent link">¬∂</a></h3>
<blockquote>
<p><strong>Not Implemented</strong>: Security metrics are not currently tracked.</p>
</blockquote>
<pre><code class="language-python"># Example: app/security/monitoring.py (NOT IMPLEMENTED)
from prometheus_client import Counter, Histogram
import time
import hashlib

# Security metrics
SECURITY_EVENTS = Counter(
    'lolstonks_security_events_total',
    'Total security events',
    ['event_type', 'severity']
)

AUTHENTICATION_ATTEMPTS = Counter(
    'lolstonks_authentication_attempts_total',
    'Total authentication attempts',
    ['result']
)

RATE_LIMIT_VIOLATIONS = Counter(
    'lolstonks_rate_limit_violations_total',
    'Total rate limit violations',
    ['ip', 'endpoint']
)

class SecurityMonitor:
    """Security monitoring and alerting."""

    @staticmethod
    def track_security_event(event_type: str, severity: str = "medium"):
        """Track security events for metrics."""
        SECURITY_EVENTS.labels(event_type=event_type, severity=severity).inc()

    @staticmethod
    def track_authentication_attempt(success: bool, ip: str):
        """Track authentication attempts."""
        result = "success" if success else "failure"
        AUTHENTICATION_ATTEMPTS.labels(result=result).inc()

        # Log suspicious patterns
        if not success:
            SecurityMonitor.check_suspicious_ip(ip)

    @staticmethod
    def check_suspicious_ip(ip: str):
        """Check for suspicious IP patterns."""
        # Hash IP for privacy
        ip_hash = hashlib.sha256(ip.encode()).hexdigest()[:16]

        # In production, you might check against:
        # - Known malicious IP databases
        # - Geographic anomalies
        # - Unusual request patterns
        pass
</code></pre>
<h2 id="security-auditing">Security Auditing<a class="headerlink" href="#security-auditing" title="Permanent link">¬∂</a></h2>
<h3 id="regular-security-checks-best-practice">Regular Security Checks (Best Practice ‚úÖ)<a class="headerlink" href="#regular-security-checks-best-practice" title="Permanent link">¬∂</a></h3>
<blockquote>
<p><strong>Recommended Practice</strong>: These scripts are examples for manual or automated security audits.</p>
</blockquote>
<pre><code class="language-bash">#!/bin/bash
# Example: security_audit.sh

echo "=== LOLStonks Security Audit ==="
echo "Date: $(date)"
echo

# Check for exposed API keys
echo "1. Checking for exposed API keys..."
if grep -r "RGAPI-" /home/lolstonks/lolstonks-api-gateway/ --exclude-dir=.git; then
    echo "‚ö†Ô∏è  WARNING: Potential exposed API keys found!"
else
    echo "‚úÖ No exposed API keys found"
fi

# Check file permissions
echo -e "\n2. Checking file permissions..."
find /home/lolstonks/lolstonks-api-gateway/ -type f -name "*.env" -exec ls -la {} \;

# Check SSL certificate expiry
echo -e "\n3. Checking SSL certificate..."
if command -v certbot &gt;/dev/null 2&gt;&amp;1; then
    certbot certificates
else
    echo "Certbot not installed"
fi

# Check firewall status
echo -e "\n4. Checking firewall status..."
sudo ufw status

# Check running services
echo -e "\n5. Checking running services..."
systemctl list-units --type=service --state=running | grep -E "(nginx|redis|lolstonks)"

# Check log for suspicious activity
echo -e "\n6. Recent security events..."
if [ -f /var/log/lolstonks/security.log ]; then
    tail -20 /var/log/lolstonks/security.log
else
    echo "Security log not found"
fi

echo -e "\n=== Audit Complete ==="
</code></pre>
<h3 id="security-checklist">Security Checklist<a class="headerlink" href="#security-checklist" title="Permanent link">¬∂</a></h3>
<ul>
<li>[ ] <strong>API Key Management</strong></li>
<li>[ ] API keys stored in environment variables only</li>
<li>[ ] Regular key rotation (every 20-25 days)</li>
<li>[ ] Separate keys for different environments</li>
<li>
<p>[ ] Backup keys available for failover</p>
</li>
<li>
<p>[ ] <strong>Input Validation</strong></p>
</li>
<li>[ ] All inputs validated using Pydantic models</li>
<li>[ ] String inputs sanitized and length-limited</li>
<li>[ ] Pattern validation for IDs and special formats</li>
<li>
<p>[ ] SQL injection prevention measures in place</p>
</li>
<li>
<p>[ ] <strong>Rate Limiting</strong></p>
</li>
<li>[ ] Global rate limits configured</li>
<li>[ ] Endpoint-specific rate limits for sensitive operations</li>
<li>[ ] IP-based blocking for abusive behavior</li>
<li>
<p>[ ] DDoS protection at multiple levels</p>
</li>
<li>
<p>[ ] <strong>Network Security</strong></p>
</li>
<li>[ ] HTTPS enforced in production</li>
<li>[ ] Strong SSL/TLS configuration</li>
<li>[ ] Security headers implemented</li>
<li>[ ] Firewall rules configured</li>
<li>
<p>[ ] CORS properly configured</p>
</li>
<li>
<p>[ ] <strong>Authentication</strong></p>
</li>
<li>[ ] Admin endpoints protected with API keys</li>
<li>[ ] Constant-time comparison for secrets</li>
<li>[ ] Secure session management</li>
<li>
<p>[ ] Proper logout mechanisms</p>
</li>
<li>
<p>[ ] <strong>Logging &amp; Monitoring</strong></p>
</li>
<li>[ ] Security events logged separately</li>
<li>[ ] Failed authentication attempts tracked</li>
<li>[ ] Suspicious activity alerts configured</li>
<li>
<p>[ ] Log files properly secured and rotated</p>
</li>
<li>
<p>[ ] <strong>Regular Maintenance</strong></p>
</li>
<li>[ ] Security audits performed regularly</li>
<li>[ ] Dependencies kept up to date</li>
<li>[ ] SSL certificates monitored for expiry</li>
<li>[ ] Backup and recovery procedures tested</li>
</ul>
<hr/>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¬∂</a></h2>
<p>This document outlines <strong>security best practices and potential implementations</strong> for production deployments.</p>
<p><strong>Current Security Measures</strong> ‚úÖ:
- Pydantic input validation on all endpoints
- Riot API rate limiting (prevents excessive API usage)
- Environment-based API key management
- Basic logging with Loguru</p>
<p><strong>Recommended Infrastructure Security</strong> (handled at deployment level):
- Firewall configuration (ufw/iptables)
- SSL/TLS termination (Nginx)
- System-level hardening</p>
<p><strong>Future Security Enhancements</strong> ‚ùå (Not Implemented):
- IP-based rate limiting and blocking
- CORS middleware
- Security event logging
- Prometheus security metrics
- API key rotation automation
- Admin endpoint authentication</p>
<p>For the actual implementation status, see <a href="../implementation-status/">Implementation Status</a>.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "toc.follow", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script>
        // Enhanced Mermaid Interactivity for LOLStonks Documentation
        (function() {
            'use strict';

            console.log('Initializing Mermaid interactivity...');

            // Wait for DOM to be ready and Mermaid diagrams to render
            const waitForMermaid = () => {
                const mermaidElements = document.querySelectorAll('.mermaid');
                console.log('Found Mermaid elements:', mermaidElements.length);

                if (mermaidElements.length === 0) {
                    console.log('No Mermaid elements found, retrying in 2 seconds...');
                    setTimeout(waitForMermaid, 2000);
                    return;
                }

                mermaidElements.forEach((element, index) => {
                    const id = element.id || 'mermaid-diagram-' + index;
                    element.setAttribute('id', id);

                    // Wait for the diagram to be rendered as SVG
                    const waitForSVG = () => {
                        const svg = element.querySelector('svg');
                        if (svg) {
                            console.log('SVG found for element:', id);
                            addInteractivityToDiagram(element, id);
                        } else {
                            console.log('SVG not found yet for element:', id, 'retrying...');
                            setTimeout(waitForSVG, 500);
                        }
                    };

                    waitForSVG();
                });
            };

            const addInteractivityToDiagram = (element, id) => {
                // Add interactive controls container
                if (!element.previousSibling) {
                    const controls = createInteractiveControls(id, element);
                    element.parentNode.insertBefore(controls, element);
                }

                // Add zoom controls
                addZoomControls(element, id);

                // Add click handlers
                addClickHandlers(element);

                // Add tooltips
                addTooltips(element);

                // Make responsive
                makeResponsive(element);

                // Add pan and zoom
                addPanAndZoom(element, id);
            };

            const createInteractiveControls = (id, element) => {
                const controls = document.createElement('div');
                controls.className = 'mermaid-controls';
                controls.style.cssText = `
                    margin: 10px 0;
                    padding: 10px;
                    background: #f5f5f5;
                    border-radius: 5px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    flex-wrap: wrap;
                    gap: 10px;
                    font-size: 14px;
                    font-family: Arial, sans-serif;
                `;

                // Zoom controls
                const zoomControls = document.createElement('div');
                zoomControls.innerHTML = `
                    <span style="font-weight: bold;">üîç Zoom:</span>
                    <button onclick="zoomDiagram('${id}', 1.2)" style="margin: 0 2px; padding: 4px 8px; background: #1976d2; color: white; border: none; border-radius: 3px; cursor: pointer;">+</button>
                    <button onclick="zoomDiagram('${id}', 0.8)" style="margin: 0 2px; padding: 4px 8px; background: #1976d2; color: white; border: none; border-radius: 3px; cursor: pointer;">‚àí</button>
                    <button onclick="resetZoom('${id}')" style="margin: 0 2px; padding: 4px 8px; background: #666; color: white; border: none; border-radius: 3px; cursor: pointer;">Reset</button>
                `;

                // Navigation info
                const navInfo = document.createElement('div');
                navInfo.innerHTML = `<span style="color: #666;">üñ±Ô∏è Click nodes for details ‚Ä¢ Scroll to zoom ‚Ä¢ Drag to pan</span>`;

                // Fullscreen button
                const fullscreenBtn = document.createElement('button');
                fullscreenBtn.textContent = '‚õ∂ Fullscreen';
                fullscreenBtn.style.cssText = `
                    padding: 4px 12px;
                    background: #388e3c;
                    color: white;
                    border: none;
                    border-radius: 3px;
                    cursor: pointer;
                `;
                fullscreenBtn.onclick = () => toggleFullscreen(id, element);

                // Download button
                const downloadBtn = document.createElement('button');
                downloadBtn.textContent = 'üì• Download';
                downloadBtn.style.cssText = `
                    padding: 4px 12px;
                    background: #ff9800;
                    color: white;
                    border: none;
                    border-radius: 3px;
                    cursor: pointer;
                `;
                downloadBtn.onclick = () => downloadDiagram(id, element);

                controls.appendChild(zoomControls);
                controls.appendChild(navInfo);
                controls.appendChild(fullscreenBtn);
                controls.appendChild(downloadBtn);

                return controls;
            };

            const addZoomControls = (element, id) => {
                element.style.transform = 'scale(1)';
                element.style.transformOrigin = 'center top';
                element.style.transition = 'transform 0.3s ease';
                element.dataset.originalTransform = 'scale(1)';
                element.dataset.currentZoom = '1';
            };

            const addPanAndZoom = (element, id) => {
                const svg = element.querySelector('svg');
                if (!svg) return;

                let isPanning = false;
                let startX = 0, startY = 0, translateX = 0, translateY = 0;

                // Mouse wheel zoom
                element.addEventListener('wheel', function(e) {
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        const delta = e.deltaY > 0 ? 0.9 : 1.1;
                        zoomDiagram(id, delta);
                    }
                });

                // Pan functionality
                svg.style.cursor = 'grab';
                svg.addEventListener('mousedown', function(e) {
                    if (e.button === 0 && !e.shiftKey) {
                        isPanning = true;
                        startX = e.clientX - translateX;
                        startY = e.clientY - translateY;
                        svg.style.cursor = 'grabbing';
                        e.preventDefault();
                    }
                });

                document.addEventListener('mousemove', function(e) {
                    if (isPanning) {
                        translateX = e.clientX - startX;
                        translateY = e.clientY - startY;
                        const currentZoom = parseFloat(element.dataset.currentZoom || 1);
                        svg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentZoom})`;
                    }
                });

                document.addEventListener('mouseup', function() {
                    isPanning = false;
                    svg.style.cursor = 'grab';
                });

                // Touch support for mobile
                let touchStartDistance = 0;
                let touchStartZoom = 1;

                element.addEventListener('touchstart', function(e) {
                    if (e.touches.length === 2) {
                        const dx = e.touches[0].clientX - e.touches[1].clientX;
                        const dy = e.touches[0].clientY - e.touches[1].clientY;
                        touchStartDistance = Math.sqrt(dx * dx + dy * dy);
                        touchStartZoom = parseFloat(element.dataset.currentZoom || 1);
                    }
                });

                element.addEventListener('touchmove', function(e) {
                    if (e.touches.length === 2) {
                        const dx = e.touches[0].clientX - e.touches[1].clientX;
                        const dy = e.touches[0].clientY - e.touches[1].clientY;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        const scale = Math.max(0.5, Math.min(3, touchStartZoom * (distance / touchStartDistance)));
                        element.dataset.currentZoom = scale;
                        const svg = element.querySelector('svg');
                        const currentZoom = parseFloat(element.dataset.currentZoom || 1);
                        svg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentZoom})`;
                    }
                });
            };

            const addClickHandlers = (element) => {
                const svg = element.querySelector('svg');
                if (!svg) return;

                const clickableElements = svg.querySelectorAll('g.node, g.edgePath, .cluster');
                clickableElements.forEach(el => {
                    el.style.cursor = 'pointer';
                    el.addEventListener('click', function(e) {
                        if (!e.shiftKey && !e.ctrlKey) {
                            e.preventDefault();
                            showNodeDetails(el, element);
                        }
                    });
                });
            };

            const addTooltips = (element) => {
                const svg = element.querySelector('svg');
                if (!svg) return;

                const nodes = svg.querySelectorAll('g.node');
                nodes.forEach(node => {
                    const rect = node.querySelector('rect');
                    const text = node.querySelector('text');
                    if (rect && text) {
                        node.title = text.textContent + ' - Click for more information';

                        node.addEventListener('mouseenter', function() {
                            rect.style.filter = 'brightness(1.2)';
                            rect.style.transition = 'filter 0.2s ease';
                        });

                        node.addEventListener('mouseleave', function() {
                            rect.style.filter = 'brightness(1)';
                        });
                    }
                });
            };

            const makeResponsive = (element) => {
                const svg = element.querySelector('svg');
                if (!svg) return;

                svg.style.maxWidth = '100%';
                svg.style.height = 'auto';
                svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');

                const resizeObserver = new ResizeObserver(() => {
                    adjustDiagramSize(element);
                });
                resizeObserver.observe(element);
            };

            const adjustDiagramSize = (element) => {
                const svg = element.querySelector('svg');
                if (!svg) return;

                const container = element.parentElement;
                const containerWidth = container.clientWidth;

                if (containerWidth < 800) {
                    const mobileZoom = Math.max(0.5, containerWidth / 800);
                    element.dataset.currentZoom = mobileZoom;
                    const translateMatch = svg.style.transform.match(/translate\(([^)]+)px/);
                    const translate = translateMatch ? translateMatch[1] : '0px, 0px';
                    svg.style.transform = `translate(${translate}) scale(${mobileZoom})`;
                }
            };

            const showNodeDetails = (nodeElement, diagramElement) => {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    z-index: 1000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;

                const content = document.createElement('div');
                content.style.cssText = `
                    background: white;
                    padding: 20px;
                    border-radius: 8px;
                    max-width: 600px;
                    max-height: 80%;
                    overflow-y: auto;
                `;

                const text = nodeElement.querySelector('text');
                const title = text ? text.textContent : 'Node Details';

                content.innerHTML = `
                    <h3>${title}</h3>
                    <p><strong>Diagram:</strong> ${diagramElement.closest('h1, h2, h3, h4, h5, h6')?.textContent || 'Architecture Diagram'}</p>
                    <p><strong>Component Type:</strong> ${getNodeInfo(nodeElement).type}</p>
                    <p>${getNodeInfo(nodeElement).description}</p>
                    <button onclick="this.closest('div[style*=fixed]').remove()" style="
                        margin-top: 15px;
                        padding: 8px 16px;
                        background: #1976d2;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                    ">Close</button>
                `;

                modal.appendChild(content);
                modal.appendChild(document.createElement('button'));
                modal.onclick = (e) => {
                    if (e.target === modal) modal.remove();
                };

                document.body.appendChild(modal);
            };

            const getNodeInfo = (nodeElement) => {
                const text = nodeElement.querySelector('text')?.textContent?.toLowerCase() || '';

                if (text.includes('api') || text.includes('gateway')) {
                    return {
                        type: 'API Component',
                        description: 'This component handles API requests, routing, and response processing in the LOLStonks Gateway.'
                    };
                } else if (text.includes('cache') || text.includes('redis')) {
                    return {
                        type: 'Cache Layer',
                        description: 'This component provides caching functionality to improve API response times and reduce external API calls.'
                    };
                } else if (text.includes('rate') || text.includes('limit')) {
                    return {
                        type: 'Rate Limiter',
                        description: 'This component enforces rate limits to prevent API abuse and ensure fair usage across all clients.'
                    };
                } else if (text.includes('auth') || text.includes('security')) {
                    return {
                        type: 'Security Component',
                        description: 'This component handles authentication, authorization, and security validation for API requests.'
                    };
                } else if (text.includes('provider') || text.includes('riot')) {
                    return {
                        type: 'External Provider',
                        description: 'This component interfaces with external APIs (like Riot Games API) to fetch game data.'
                    };
                } else {
                    return {
                        type: 'System Component',
                        description: 'This component is part of the LOLStonks API Gateway architecture. Click on different components to explore the system design.'
                    };
                }
            };

            // Global functions for button controls
            window.zoomDiagram = function(id, factor) {
                const element = document.getElementById(id);
                if (!element) return;

                const currentZoom = parseFloat(element.dataset.currentZoom || 1);
                const newZoom = Math.max(0.1, Math.min(3, currentZoom * factor));

                const svg = element.querySelector('svg');
                const currentTransform = svg.style.transform || '';
                const translateMatch = currentTransform.match(/translate\(([^)]+)px/);
                const translate = translateMatch ? translateMatch[1] : '0px, 0px';

                svg.style.transform = `translate(${translate}) scale(${newZoom})`;
                element.dataset.currentZoom = newZoom;
            };

            window.resetZoom = function(id) {
                const element = document.getElementById(id);
                if (!element) return;

                const svg = element.querySelector('svg');
                svg.style.transform = 'translate(0px, 0px) scale(1)';
                element.dataset.currentZoom = '1';
            };

            window.toggleFullscreen = function(id, element) {
                if (element.style.position === 'fixed') {
                    // Exit fullscreen
                    element.style.position = '';
                    element.style.top = '';
                    element.style.left = '';
                    element.style.width = '';
                    element.style.height = '';
                    element.style.zIndex = '';
                    element.style.backgroundColor = '';
                    element.style.padding = '';
                    element.style.overflow = '';
                    resetZoom(id);
                } else {
                    // Enter fullscreen
                    element.style.position = 'fixed';
                    element.style.top = '0';
                    element.style.left = '0';
                    element.style.width = '100vw';
                    element.style.height = '100vh';
                    element.style.zIndex = '999';
                    element.style.backgroundColor = 'white';
                    element.style.padding = '20px';
                    element.style.overflow = 'auto';
                    zoomDiagram(id, 1.5);
                }
            };

            window.downloadDiagram = function(id, element) {
                const svg = element.querySelector('svg');
                if (!svg) return;

                const svgData = new XMLSerializer().serializeToString(svg);
                const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
                const svgUrl = URL.createObjectURL(svgBlob);

                const downloadLink = document.createElement('a');
                downloadLink.href = svgUrl;
                downloadLink.download = `${id || 'diagram'}-${Date.now()}.svg`;
                downloadLink.click();

                URL.revokeObjectURL(svgUrl);
            };

            // Initialize everything
            waitForMermaid();

        })();
    </script>
</body>
</html>